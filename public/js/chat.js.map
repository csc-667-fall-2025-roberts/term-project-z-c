{"version":3,"file":"chat.js","sources":["../../chat.ts"],"sourcesContent":["import socketIo from \"socket.io-client\";\r\nimport type { ChatMessage } from \"../types/types\";\r\nimport * as chatKeys from \"../shared/keys\";\r\n\r\nconst socket = socketIo();\r\n\r\nconst listing = document.querySelector<HTMLDivElement>(\"#message-listing\")!;\r\nconst input = document.querySelector<HTMLInputElement>(\"#message-submit input\")!;\r\nconst button = document.querySelector<HTMLButtonElement>(\"#message-submit button\")!;\r\nconst messageTemplate = document.querySelector<HTMLTemplateElement>(\"#template-chat-message\")!;\r\n\r\nconst appendMessage = ({ username, created_at, message }: ChatMessage) => {\r\n  const clone = messageTemplate.content.cloneNode(true) as DocumentFragment;\r\n\r\n  const timeSpan = clone.querySelector(\".message-time\");\r\n  const time = new Date(created_at);\r\n  timeSpan!.textContent = time.toLocaleDateString();\r\n  console.log(time, timeSpan);\r\n\r\n  const usernameSpan = clone.querySelector(\".message-username\");\r\n  usernameSpan!.textContent = username;\r\n  console.log(username, usernameSpan);\r\n\r\n  const msgSpan = clone.querySelector(\".message-text\");\r\n  msgSpan!.textContent = message;\r\n  console.log(message, msgSpan);\r\n\r\n  listing.appendChild(clone);\r\n};\r\n\r\nsocket.on(chatKeys.CHAT_LISTING, ({ messages }: { messages: ChatMessage[] }) => {\r\n  console.log(chatKeys.CHAT_LISTING, { messages });\r\n\r\n  messages.forEach((message) => {\r\n    appendMessage(message);\r\n  });\r\n});\r\n\r\nsocket.on(chatKeys.CHAT_MESSAGE, (message: ChatMessage) => {\r\n  console.log(chatKeys.CHAT_MESSAGE, message);\r\n\r\n  appendMessage(message);\r\n});\r\n\r\nconst sendMessage = () => {\r\n  const message = input.value.trim();\r\n\r\n  if (message.length > 0) {\r\n    const body = JSON.stringify({ message });\r\n\r\n    fetch(\"/chat/\", {\r\n      method: \"post\",\r\n      body,\r\n      credentials: \"include\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    });\r\n  }\r\n\r\n  input.value = \"\";\r\n};\r\n\r\nbutton.addEventListener(\"click\", (event) => {\r\n  event.preventDefault();\r\n\r\n  sendMessage();\r\n});\r\n\r\ninput.addEventListener(\"keydown\", (event) => {\r\n  if (event.key == \"Enter\") {\r\n    sendMessage();\r\n  }\r\n});\r\n\r\n// Load message history when page loads\r\nfetch(\"/chat/\", {\r\n  method: \"get\",\r\n  credentials: \"include\",\r\n});\r\n"],"names":["socket","socketIo","listing","input","button","messageTemplate","appendMessage","username","created_at","message","clone","timeSpan","time","usernameSpan","msgSpan","chatKeys.CHAT_LISTING","messages","chatKeys.CHAT_MESSAGE","sendMessage","body","event"],"mappings":"4DAIA,MAAMA,EAASC,EAAA,EAETC,EAAU,SAAS,cAA8B,kBAAkB,EACnEC,EAAQ,SAAS,cAAgC,uBAAuB,EACxEC,EAAS,SAAS,cAAiC,wBAAwB,EAC3EC,EAAkB,SAAS,cAAmC,wBAAwB,EAEtFC,EAAgB,CAAC,CAAE,SAAAC,EAAU,WAAAC,EAAY,QAAAC,KAA2B,CACxE,MAAMC,EAAQL,EAAgB,QAAQ,UAAU,EAAI,EAE9CM,EAAWD,EAAM,cAAc,eAAe,EAC9CE,EAAO,IAAI,KAAKJ,CAAU,EAChCG,EAAU,YAAcC,EAAK,mBAAA,EAC7B,QAAQ,IAAIA,EAAMD,CAAQ,EAE1B,MAAME,EAAeH,EAAM,cAAc,mBAAmB,EAC5DG,EAAc,YAAcN,EAC5B,QAAQ,IAAIA,EAAUM,CAAY,EAElC,MAAMC,EAAUJ,EAAM,cAAc,eAAe,EACnDI,EAAS,YAAcL,EACvB,QAAQ,IAAIA,EAASK,CAAO,EAE5BZ,EAAQ,YAAYQ,CAAK,CAC3B,EAEAV,EAAO,GAAGe,EAAuB,CAAC,CAAE,SAAAC,KAA4C,CAC9E,QAAQ,IAAID,EAAuB,CAAE,SAAAC,EAAU,EAE/CA,EAAS,QAASP,GAAY,CAC5BH,EAAcG,CAAO,CACvB,CAAC,CACH,CAAC,EAEDT,EAAO,GAAGiB,EAAwBR,GAAyB,CACzD,QAAQ,IAAIQ,EAAuBR,CAAO,EAE1CH,EAAcG,CAAO,CACvB,CAAC,EAED,MAAMS,EAAc,IAAM,CACxB,MAAMT,EAAUN,EAAM,MAAM,KAAA,EAE5B,GAAIM,EAAQ,OAAS,EAAG,CACtB,MAAMU,EAAO,KAAK,UAAU,CAAE,QAAAV,EAAS,EAEvC,MAAM,SAAU,CACd,OAAQ,OACR,KAAAU,EACA,YAAa,UACb,QAAS,CACP,eAAgB,kBAAA,CAClB,CACD,CACH,CAEAhB,EAAM,MAAQ,EAChB,EAEAC,EAAO,iBAAiB,QAAUgB,GAAU,CAC1CA,EAAM,eAAA,EAENF,EAAA,CACF,CAAC,EAEDf,EAAM,iBAAiB,UAAYiB,GAAU,CACvCA,EAAM,KAAO,SACfF,EAAA,CAEJ,CAAC,EAGD,MAAM,SAAU,CACd,OAAQ,MACR,YAAa,SACf,CAAC"}